<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="记录工作，感悟生活"><meta name="keywords" content="java"><meta name="author" content="Donny"><meta name="copyright" content="Donny"><title>记录工作，感悟生活 | Donny的技术博客</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitment/style/default.min.css"><script src="https://cdn.jsdelivr.net/npm/gitment/dist/gitment.browser.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?cd5c94069361da06af29cd21555dc451";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-112010940-1', 'auto');
ga('send', 'pageview');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.jpg"></div><div class="author-info__name text-center">Donny</div><div class="author-info__description text-center">记录工作，感悟生活</div><div class="follow-button"><a href="https://gitee.com/tommy88">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">273</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">50</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">3</span></a></div></div></div><nav id="nav" style="background-image: url(/img/top_img.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Donny的技术博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">Donny的技术博客</div><div id="site-sub-title">记录工作，感悟生活</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/05/springcloud系列22——Zuul简介及代码示例/">springcloud系列22——Zuul简介及代码示例</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-05</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/tech/">技术</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springcloud/">springcloud</a></span><div class="content"><h2 id="Zuul简介"><a href="#Zuul简介" class="headerlink" title="Zuul简介"></a>Zuul简介</h2><p>spring cloud官方文档地址：<a href="http://cloud.spring.io/spring-cloud-static/Edgware.SR3/multi/multi__router_and_filter_zuul.html">http://cloud.spring.io/spring-cloud-static/Edgware.SR3/multi/multi__router_and_filter_zuul.html</a></p>
<p>路由是微服务架构的组成部分。 例如，/可以映射到您的Web应用程序，/ api/users映射到用户服务，/api/shop映射到商店服务。 Zuul是Netflix基于JVM的路由器和服务器端负载均衡器。</p>
<p>Netflix使用Zuul进行以下操作：<br>认证<br>洞察<br>压力测试<br>金丝雀测试<br>动态路由<br>服务迁移<br>负载脱落<br>安全<br>静态响应处理<br>主动/主动流量管理  </p>
<p>Zuul的规则引擎允许任何JVM语言编写规则和过滤器，内置支持Java和Groovy。</p>
<p>配置属性zuul.max.host.connections已被两个新属性zuul.host.maxTotalConnections和zuul.host.maxPerRouteConnections取代，它们分别默认为200和20。</p>
<p>所有路由的默认Hystrix隔离模式（ExecutionIsolationStrategy）是SEMAPHORE。 如果首选此隔离模式，则可以将zuul.ribbonIsolationStrategy更改为THREAD。<br></p></div><a class="more" href="/2018/07/05/springcloud系列22——Zuul简介及代码示例/#more">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/03/springcloud系列20——Turbine聚合各个节点的hystrix.stream/">springcloud系列20——Turbine聚合各个节点的hystrix.stream</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-03</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/tech/">技术</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springcloud/">springcloud</a></span><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我们在之前讲过，在单个的Hystrix的应用中，我们使用/hystrix.stream可以查看监控数据，如果想以图表的形式更直观的查看监控数据，再结合dashboard就可以了。</p>
<p>但是，如何同时监控多个应用或集群呢？<br>我们需要使用springcloud提供的Turbine，它是将各个应用的/hystrix.stream进行聚合的组件。我们在dashboard中输入/turbine.stream即可查看所有监控应用的健康情况。</p>
<p>turbine的官方文档：<a href="http://cloud.spring.io/spring-cloud-static/Edgware.SR3/multi/multi__hystrix_timeouts_and_ribbon_clients.html#_turbine">http://cloud.spring.io/spring-cloud-static/Edgware.SR3/multi/multi__hystrix_timeouts_and_ribbon_clients.html#_turbine</a><br></p></div><a class="more" href="/2018/07/03/springcloud系列20——Turbine聚合各个节点的hystrix.stream/#more">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/06/30/springcloud系列19——Feign使用fallbackFactory属性打印fallback异常/">springcloud系列19——Feign使用fallbackFactory属性打印fallback异常</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-30</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/tech/">技术</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springcloud/">springcloud</a></span><div class="content"><p>在FeignClient中，我们通过制定fallback，可以在服务不可用时自动调用fallback制定的处理方法。</p>
<p>但如果如果希望同时知道发生回退的原因呢？</p>
<p>可以使用fallbackFactory属性。</p>
<p>下面以microservice-springcloud-movie-feign-with-hystrix模块来说明。<br></p></div><a class="more" href="/2018/06/30/springcloud系列19——Feign使用fallbackFactory属性打印fallback异常/#more">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/06/30/springcloud系列18——全局和单个禁用Feign Client对Hystrix的支持/">springcloud系列18——全局和单个禁用Feign Client对Hystrix的支持</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-30</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/tech/">技术</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springcloud/">springcloud</a></span><div class="content">全局禁用这个比较简单，在application.yml中配置：123feign:  hystrix:    enabled: false
加上这段配置就可以了。
禁用某个Feign Client对Hystrix的支持1.新建一个配置类12345678910111213@Configurationpu ...</div><a class="more" href="/2018/06/30/springcloud系列18——全局和单个禁用Feign Client对Hystrix的支持/#more" style="margin-top: 14px">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/06/29/springcloud系列17——Feign的Hystrix支持/">springcloud系列17——Feign的Hystrix支持</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-29</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/tech/">技术</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springcloud/">springcloud</a></span><div class="content"><h2 id="Feign的Hystrix支持"><a href="#Feign的Hystrix支持" class="headerlink" title="Feign的Hystrix支持"></a>Feign的Hystrix支持</h2><p>springcloud官方文档参考：<a href="http://cloud.spring.io/spring-cloud-static/Edgware.SR3/single/spring-cloud.html#spring-cloud-feign-hystrix">17.4 Feign Hystrix Support</a>.</p>
<p>如果Hystrix在类路径上并且feign.hystrix.enabled = true，Feign将用断路器包装所有方法。</p>
<p>如果只是想某个Feign Client禁用Hystrix，可以创建一个普通的Feign.Builder，并将scope设置为prototype。</p>
<p>例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FooConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line">    <span class="keyword">public</span> Feign.<span class="function">Builder <span class="title">feignBuilder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Feign.builder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></div><a class="more" href="/2018/06/29/springcloud系列17——Feign的Hystrix支持/#more">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/06/25/springcloud官方文档中文翻译版/">springcloud官方文档中文翻译版</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/tech/">技术</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springcloud/">springcloud</a></span><div class="content">https://springcloud.cc/spring-cloud-netflix.html
</div><a class="more" href="/2018/06/25/springcloud官方文档中文翻译版/#more" style="margin-top: 14px">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/06/25/springcloud系列16——Hystrix Health Indicator及Metrics Stream/">springcloud系列16——Hystrix Health Indicator及Metrics Stream</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/tech/">技术</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springcloud/">springcloud</a></span><div class="content"><h2 id="传播安全上下文或使用Spring-Scopes"><a href="#传播安全上下文或使用Spring-Scopes" class="headerlink" title="传播安全上下文或使用Spring Scopes"></a>传播安全上下文或使用Spring Scopes</h2><p>参考springcloud官方文档：<a href="http://cloud.spring.io/spring-cloud-static/Edgware.SR3/single/spring-cloud.html#_propagating_the_security_context_or_using_spring_scopes">http://cloud.spring.io/spring-cloud-static/Edgware.SR3/single/spring-cloud.html#_propagating_the_security_context_or_using_spring_scopes</a>。</p>
<p>springcloud原文：</p>
<blockquote>
<p>If you want some thread local context to propagate into a @HystrixCommand the default declaration will not work because it executes the command in a thread pool (in case of timeouts). You can switch Hystrix to use the same thread as the caller using some configuration, or directly in the annotation, by asking it to use a different “Isolation Strategy”. </p>
</blockquote>
<p>翻译：</p>
<blockquote>
<p>如果你想要一些线程本地上下文传播到@HystrixCommand，默认声明将不起作用，因为它在线程池中执行命令（在超时的情况下）。 您可以使用某种配置将Hystrix切换为与调用方使用相同的线程，或者直接在注释中请求它使用不同的“隔离策略”。<br></p></blockquote></div><a class="more" href="/2018/06/25/springcloud系列16——Hystrix Health Indicator及Metrics Stream/#more">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/06/25/springcloud系列15——hystrix简介及简单代码示例/">springcloud系列15——hystrix简介及简单代码示例</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/tech/">技术</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springcloud/">springcloud</a></span><div class="content"><h2 id="Hystrix简介"><a href="#Hystrix简介" class="headerlink" title="Hystrix简介"></a>Hystrix简介</h2><p>在微服务中，有服务A、B，C，D4个微服务。其中，C依赖D，A和B依赖C。<br>那么当D出现问题时，会导致C不可用，进而导致A和B也不可用。这就是产生了雪崩效应。</p>
<p>hystrix语义为“豪猪”，它身上有很多刺，具有自我保护的能力。hystrix的出现即为解决雪崩效应。</p>
<p>关于Hystrix的原理可用参考：<a href="https://www.jianshu.com/p/e07661b9bae8">https://www.jianshu.com/p/e07661b9bae8</a>。</p>
<p>spring cloud hystrix相关内容参考：<a href="http://cloud.spring.io/spring-cloud-static/Edgware.SR3/single/spring-cloud.html#_circuit_breaker_hystrix_clients">http://cloud.spring.io/spring-cloud-static/Edgware.SR3/single/spring-cloud.html#_circuit_breaker_hystrix_clients</a>。<br></p></div><a class="more" href="/2018/06/25/springcloud系列15——hystrix简介及简单代码示例/#more">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/06/22/springcloud系列14——Eureka、Ribbon和Feign常见问题和解决/">springcloud系列14——Eureka、Ribbon和Feign常见问题和解决</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/tech/">技术</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springcloud/">springcloud</a></span><div class="content"><h3 id="1-修改System-Status的Environment和Data-Center"><a href="#1-修改System-Status的Environment和Data-Center" class="headerlink" title="1.修改System Status的Environment和Data Center"></a>1.修改System Status的Environment和Data Center</h3><p>如图：<br><img src="http://omh46px9n.bkt.clouddn.com/18-6-22/70268387.jpg" alt></p>
<p>增加如下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eureka:</span><br><span class="line">  environment: product</span><br><span class="line">  datacenter: spring cloud</span><br></pre></td></tr></table></figure></p>
<p>或者在启动时使用<code>-Deureka.datacenter=spring cloud</code>这种方式来指定。<br></p></div><a class="more" href="/2018/06/22/springcloud系列14——Eureka、Ribbon和Feign常见问题和解决/#more">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/06/09/hexo-blog-from-github-to-gitee/">hexo博客从github迁移到gitee</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-09</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/tech/">技术</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/hexo/">hexo</a></span><div class="content"><p>gitee感觉做的不错，而且是国内的，速度要比github快不少。所以将博客从github迁移到gitee。<br></p></div><a class="more" href="/2018/06/09/hexo-blog-from-github-to-gitee/#more">Read more</a><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(/img/top_img.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2015 - 2019 By Donny</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>